"""
ChromaDBì— ìƒ˜í”Œ ë°ì´í„° ì¶”ê°€ ìŠ¤í¬ë¦½íŠ¸

ì‚¬ìš©ë²•:
    cd server/llm_service
    python add_sample_data.py
"""
import asyncio
import os
import sys
from pathlib import Path
from dotenv import load_dotenv

# .env íŒŒì¼ ë¡œë“œ
env_paths = [
    Path(__file__).parent.parent.parent / ".env",
    Path(__file__).parent.parent / ".env",
    Path(__file__).parent / ".env",
]

for env_path in env_paths:
    if env_path.exists():
        load_dotenv(env_path)
        break

sys.path.insert(0, str(Path(__file__).parent.parent))

from services.vector_service import VectorService
import logging

logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')

async def add_sample_data():
    """ìƒ˜í”Œ ë°ì´í„° ì¶”ê°€"""
    print("=" * 60)
    print("ğŸ“ ChromaDBì— ìƒ˜í”Œ ë°ì´í„° ì¶”ê°€")
    print("=" * 60)
    
    # OpenAI API í‚¤ í™•ì¸
    api_key = os.getenv("OPENAI_API_KEY")
    if not api_key:
        print("âŒ OPENAI_API_KEYê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
        return
    
    print(f"âœ… OpenAI API í‚¤ í™•ì¸ë¨")
    
    # VectorService ì´ˆê¸°í™”
    print("\n1ï¸âƒ£ VectorService ì´ˆê¸°í™” ì¤‘...")
    try:
        vector_service = VectorService()
        print("âœ… ì´ˆê¸°í™” ì™„ë£Œ")
    except Exception as e:
        print(f"âŒ ì´ˆê¸°í™” ì‹¤íŒ¨: {e}")
        return
    
    # ê¸°ì¡´ ë°ì´í„° í™•ì¸
    try:
        collection = vector_service.vector_store._collection
        all_data = collection.get(limit=10000)
        existing_count = len(all_data.get('documents', []))
        print(f"\nğŸ“Š ê¸°ì¡´ ë¬¸ì„œ ìˆ˜: {existing_count}ê°œ")
    except Exception as e:
        print(f"âš ï¸  ê¸°ì¡´ ë°ì´í„° í™•ì¸ ì‹¤íŒ¨: {e}")
        existing_count = 0
    
    # ìƒ˜í”Œ ë¬¸ì„œ (25ê°œ)
    sample_docs = [
        # ìˆ˜ë©´ ê´€ë ¨ (5ê°œ)
        "ì•„ì´ê°€ ë°¤ì— ì ì„ ì•ˆ ììš”. ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œìš”? ìˆ˜ë©´ êµìœ¡ì´ í•„ìš”í• ê¹Œìš”?",
        "ë°¤ì— ì•„ì´ê°€ ê¹¨ì„œ ìš¸ì–´ìš”. ëŒ€ì²˜ ë°©ë²•ì€ ë¬´ì—‡ì¸ê°€ìš”? ìˆ˜ë©´ íŒ¨í„´ì„ ê°œì„ í•˜ê³  ì‹¶ì–´ìš”.",
        "ìˆ˜ë©´ êµìœ¡ ë°©ë²•ì— ëŒ€í•´ ì•Œë ¤ì£¼ì„¸ìš”. ì•„ì´ê°€ ì ë“¤ê¸° ì–´ë ¤ì›Œí•˜ëŠ”ë° ë„ì›€ì´ í•„ìš”í•©ë‹ˆë‹¤.",
        "ì•„ì´ ìˆ˜ë©´ íŒ¨í„´ ê°œì„ í•˜ê¸° ìœ„í•œ êµ¬ì²´ì ì¸ ë°©ë²•ì„ ì•Œê³  ì‹¶ì–´ìš”. ìˆ˜ë©´ ìŠµê´€ì„ ë§Œë“¤ê³  ì‹¶ìŠµë‹ˆë‹¤.",
        "ë¶ˆë©´ì¦ í•´ê²° ë°©ë²•ì„ ì°¾ê³  ìˆì–´ìš”. ì•„ì´ê°€ ë°¤ì— ìì£¼ ê¹¨ì„œ ê±±ì •ì´ ë©ë‹ˆë‹¤.",
        
        # ì¼ì • ê´€ë¦¬ (5ê°œ)
        "ìœ¡ì•„ ì¼ì •ì„ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì„ ì•Œë ¤ì£¼ì„¸ìš”. ì—¬ëŸ¬ ì•„ì´ì˜ ì¼ì •ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê³  ì‹¶ì–´ìš”.",
        "ì–´ë¦°ì´ì§‘ í–‰ì‚¬ ì¼ì •ì„ ìŠì§€ ì•Šê¸° ìœ„í•œ ë°©ë²•ì´ í•„ìš”í•´ìš”. ì•Œë¦¼ ì„¤ì •ì„ í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤.",
        "ì˜ë£Œ ì§„ë£Œ ì¼ì •ì„ ê´€ë¦¬í•˜ëŠ” ì•±ì´ë‚˜ ë°©ë²•ì„ ì¶”ì²œí•´ì£¼ì„¸ìš”. ì˜ˆë°©ì ‘ì¢… ì¼ì •ë„ í•¨ê»˜ ê´€ë¦¬í•˜ê³  ì‹¶ì–´ìš”.",
        "ìœ¡ì•„ ì¼ì • ê³µìœ  ê¸°ëŠ¥ì´ í•„ìš”í•´ìš”. ë°°ìš°ìì™€ í•¨ê»˜ ì¼ì •ì„ í™•ì¸í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤.",
        "ì•„ì´ì˜ ì¼ì¼ ì¼ì •ì„ ê¸°ë¡í•˜ê³  ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì„ ì•Œê³  ì‹¶ì–´ìš”. ìˆ˜ë©´ ì‹œê°„ê³¼ ì‹ì‚¬ ì‹œê°„ì„ ì¶”ì í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤.",
        
        # ì»¤ë®¤ë‹ˆí‹° (5ê°œ)
        "ì»¤ë®¤ë‹ˆí‹°ì—ì„œ ë‹¤ë¥¸ ë¶€ëª¨ë‹˜ë“¤ê³¼ ì •ë³´ë¥¼ ê³µìœ í•˜ê³  ì‹¶ì–´ìš”. ìœ¡ì•„ ê²½í—˜ì„ ë‚˜ëˆ„ê³  ì‹¶ìŠµë‹ˆë‹¤.",
        "ê·¼ì²˜ ìœ¡ì•„ ì»¤ë®¤ë‹ˆí‹°ë¥¼ ì°¾ê³  ìˆì–´ìš”. ê°™ì€ ì§€ì—­ì˜ ë¶€ëª¨ë‹˜ë“¤ê³¼ ë§Œë‚˜ê³  ì‹¶ìŠµë‹ˆë‹¤.",
        "ê³µë™êµ¬ë§¤ ì»¤ë®¤ë‹ˆí‹°ì— ì°¸ì—¬í•˜ê³  ì‹¶ì–´ìš”. ê¸°ì €ê·€ë‚˜ ë¶„ìœ ë¥¼ í•¨ê»˜ êµ¬ë§¤í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤.",
        "ìœ¡ì•„ ì •ë³´ë¥¼ ê³µìœ í•˜ëŠ” ì˜¨ë¼ì¸ ì»¤ë®¤ë‹ˆí‹°ë¥¼ ì¶”ì²œí•´ì£¼ì„¸ìš”. ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì •ë³´ë¥¼ ì–»ê³  ì‹¶ì–´ìš”.",
        "ì•„íŒŒíŠ¸ ë‹¨ì§€ ë‚´ ìœ¡ì•„ ëª¨ì„ì„ ë§Œë“¤ê³  ì‹¶ì–´ìš”. ì´ì›ƒ ë¶€ëª¨ë‹˜ë“¤ê³¼ êµë¥˜í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤.",
        
        # ê±´ê°•/ì˜ë£Œ (5ê°œ)
        "ì•„ì´ê°€ ì—´ì´ ë‚˜ìš”. ì–¸ì œ ë³‘ì›ì— ê°€ì•¼ í• ê¹Œìš”? ì‘ê¸‰ ìƒí™©ì¸ì§€ í™•ì¸í•˜ê³  ì‹¶ì–´ìš”.",
        "ì˜ˆë°©ì ‘ì¢… ì¼ì •ì„ í™•ì¸í•˜ê³  ì‹¶ì–´ìš”. ë‹¤ìŒ ì ‘ì¢…ì´ ì–¸ì œì¸ì§€ ì•Œë ¤ì£¼ì„¸ìš”.",
        "ì•„ì´ì˜ ì„±ì¥ ë°œë‹¬ì´ ì •ìƒì¸ì§€ í™•ì¸í•˜ê³  ì‹¶ì–´ìš”. ì›”ë ¹ë³„ ë°œë‹¬ ê¸°ì¤€ì„ ì•Œê³  ì‹¶ìŠµë‹ˆë‹¤.",
        "ì†Œì•„ê³¼ ì¶”ì²œì„ ë°›ê³  ì‹¶ì–´ìš”. ìš°ë¦¬ ì§€ì—­ì— ì¢‹ì€ ì†Œì•„ê³¼ê°€ ìˆì„ê¹Œìš”?",
        "ì•„ì´ ê±´ê°• ê²€ì§„ ì¼ì •ì„ ê´€ë¦¬í•˜ê³  ì‹¶ì–´ìš”. ì •ê¸° ê²€ì§„ì„ ë†“ì¹˜ì§€ ì•Šê¸° ìœ„í•œ ë°©ë²•ì´ í•„ìš”í•©ë‹ˆë‹¤.",
        
        # êµìœ¡/ë†€ì´ (5ê°œ)
        "ì•„ì´ì™€ í•¨ê»˜ í•  ìˆ˜ ìˆëŠ” ì‹¤ë‚´ ë†€ì´ í™œë™ì„ ì¶”ì²œí•´ì£¼ì„¸ìš”. ë¹„ê°€ ì™€ì„œ ì§‘ì— ìˆì–´ì•¼ í•´ìš”.",
        "ìœ ì•„ êµìœ¡ í”„ë¡œê·¸ë¨ì„ ì°¾ê³  ìˆì–´ìš”. ìš°ë¦¬ ì•„ì´ ì—°ë ¹ì— ë§ëŠ” í”„ë¡œê·¸ë¨ì„ ì•Œê³  ì‹¶ìŠµë‹ˆë‹¤.",
        "ë…ì„œ ìŠµê´€ì„ ê¸°ë¥´ëŠ” ë°©ë²•ì„ ì•Œë ¤ì£¼ì„¸ìš”. ì•„ì´ê°€ ì±…ì„ ì¢‹ì•„í•˜ë„ë¡ ë§Œë“¤ê³  ì‹¶ì–´ìš”.",
        "ì•„ì´ì™€ í•¨ê»˜ ê°ˆ ìˆ˜ ìˆëŠ” êµìœ¡ ì²´í—˜ê´€ì„ ì¶”ì²œí•´ì£¼ì„¸ìš”. ì£¼ë§ì— ê°€ë³¼ ë§Œí•œ ê³³ì„ ì°¾ê³  ìˆì–´ìš”.",
        "ë†€ì´í„°ì—ì„œ ì•ˆì „í•˜ê²Œ ë†€ ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì•Œë ¤ì£¼ì„¸ìš”. ì•„ì´ê°€ ë‹¤ì¹˜ì§€ ì•Šë„ë¡ ì£¼ì˜ì‚¬í•­ì„ ì•Œê³  ì‹¶ì–´ìš”."
    ]
    
    print(f"\n2ï¸âƒ£ {len(sample_docs)}ê°œ ìƒ˜í”Œ ë¬¸ì„œ ì¶”ê°€ ì¤‘...")
    print("   (ì´ ì‘ì—…ì€ ëª‡ ë¶„ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤ - OpenAI API í˜¸ì¶œ)")
    
    added_count = 0
    failed_count = 0
    
    for i, doc in enumerate(sample_docs, 1):
        try:
            await vector_service.add_schedule_info(
                user_id="sample_user",
                schedule_text=doc,
                intent="general",
                urgency="low"
            )
            added_count += 1
            print(f"   âœ… [{i}/{len(sample_docs)}] ì¶”ê°€ ì™„ë£Œ")
        except Exception as e:
            failed_count += 1
            print(f"   âŒ [{i}/{len(sample_docs)}] ì¶”ê°€ ì‹¤íŒ¨: {e}")
    
    # ìµœì¢… í™•ì¸
    print(f"\n3ï¸âƒ£ ìµœì¢… í™•ì¸ ì¤‘...")
    await asyncio.sleep(2)  # ì¸ë±ìŠ¤ ì—…ë°ì´íŠ¸ ëŒ€ê¸°
    
    try:
        collection = vector_service.vector_store._collection
        all_data = collection.get(limit=10000)
        final_count = len(all_data.get('documents', []))
        
        print(f"\n" + "=" * 60)
        print(f"ğŸ“Š ê²°ê³¼ ìš”ì•½")
        print("=" * 60)
        print(f"   ê¸°ì¡´ ë¬¸ì„œ: {existing_count}ê°œ")
        print(f"   ì¶”ê°€ ì‹œë„: {len(sample_docs)}ê°œ")
        print(f"   ì„±ê³µ: {added_count}ê°œ")
        print(f"   ì‹¤íŒ¨: {failed_count}ê°œ")
        print(f"   ìµœì¢… ë¬¸ì„œ ìˆ˜: {final_count}ê°œ")
        
        if final_count >= 20:
            print(f"\nâœ… ì¶©ë¶„í•œ ë°ì´í„°ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!")
            print(f"   ì´ì œ measure_search_accuracy.pyë¥¼ ì‹¤í–‰í•˜ì—¬ ì •í™•ë„ë¥¼ ì¸¡ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
        else:
            print(f"\nâš ï¸  ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. (ê¶Œì¥: 20ê°œ ì´ìƒ)")
        
    except Exception as e:
        print(f"âŒ ìµœì¢… í™•ì¸ ì‹¤íŒ¨: {e}")
    
    print("\n" + "=" * 60)
    print("âœ… ì™„ë£Œ!")
    print("=" * 60)

if __name__ == "__main__":
    asyncio.run(add_sample_data())

