# CLAUDE AI 개발 가이드라인

## 🚨 CRITICAL - 크레딧 절약 원칙

### 절대 규칙
1. **백그라운드 프로세스 최소화** - 서버는 테스트할 때만 실행하고 즉시 종료
2. **필요할 때만 서버 실행** - 개발/테스트 완료되면 바로 KillBash 사용
3. **코드 수정은 파일 편집으로만** - 불필요한 서버 재시작 금지
4. **중복 질문 금지** - 이 문서를 참조하여 가이드라인 숙지
5. **🚨 위험한 Git 명령어 금지** - reset --hard, clean -fd 등 파일 손실 위험 명령어 사용 전 반드시 손실 파일 확인

### 크레딧 소모 방지
- ❌ 장시간 백그라운드 프로세스 실행 금지
- ❌ 불필요한 서버 중복 실행 금지
- ❌ 테스트 완료 후 서버 종료 안함 금지
- ✅ 코드 수정 → 파일 저장 → 필요시에만 테스트

### 🚨 파일 손실 방지 (매우 중요!)
- ❌ **git reset --hard HEAD** 금지 - 작업 파일 완전 삭제 위험
- ❌ **git clean -fd** 금지 - 추적되지 않은 파일 삭제 위험
- ❌ 성급한 충돌 해결 금지 - 항상 손실 파일 먼저 확인
- ✅ **손실 파일 사전 확인 필수** - git status로 삭제될 파일 목록 확인
- ✅ **git stash** 우선 사용 - 안전한 임시 저장
- ✅ **충돌 시 개별 파일 체크아웃** - 전체 리셋 대신 필요 파일만 복구

---

## 🏗️ 프로젝트 구조

### 현재 아키텍처
```
/home/user/webapp/
├── frontend/          # Next.js 프론트엔드 (Port 3000)
├── server/           
│   ├── llm_service/   # AI 채팅 서비스 (Port 8002)
│   └── backend/       # 메인 백엔드 (Port 8000)
├── main.py            # 테스트용 FastAPI 백엔드
├── README.md          # 프로젝트 전체 가이드
└── CLAUDE.md          # 이 파일 (개발 가이드라인)
```

### 포트 할당
- **3000**: Next.js 프론트엔드 (npm run dev)
- **8000**: 메인 백엔드 API 서버
- **8002**: AI/LLM 채팅 서비스
- **49999**: 테스트용 포트 (필요시에만 사용)

---

## 🔧 개발 워크플로우

### 🔒 브랜치 관리 체계
- **현재 브랜치**: 테스트 전용 브랜치 (메인 브랜치와 완전 분리)
- **메인 브랜치**: **절대 건드리지 말 것!** - 사용자 전용
- **배포 서버**: 사용자가 별도 관리 (신경 쓰지 말 것)
- **목적**: AI가 자유롭게 테스트할 수 있는 격리된 환경

### 📋 엄격한 개발 프로세스
1. **코드 수정**: 파일 편집으로만 진행
2. **테스트 필요시**: 
   - 서버 실행 (run_in_background: true)
   - 테스트 수행
   - **즉시 KillBash로 종료**
3. **커밋**: 테스트 브랜치에서만 커밋
4. **PR 생성**: 테스트 브랜치 → 메인 브랜치
5. **머지**: **반드시 사용자와 상의 후에만**
6. **머지 후**: **즉시 테스트 브랜치로 돌아가기**

### ⚠️ 절대 지켜야 할 워크플로우
```
테스트 브랜치 작업 → 커밋 → PR 생성 → 사용자 상의 → 머지 승인 → 테스트 브랜치 복귀
```

---

## 🛠️ 기술 스택 & API

### Frontend (Next.js)
- **프레임워크**: Next.js 14 + TypeScript
- **스타일링**: Tailwind CSS
- **인증**: Firebase Auth
- **지도**: 네이버 지도 API
- **상태관리**: React useState/useEffect

### Backend Services
- **메인 API**: FastAPI (Port 8000)
- **AI 서비스**: FastAPI + OpenAI GPT-4o-mini (Port 8002)
- **데이터베이스**: Firebase Realtime DB + Firestore
- **벡터 검색**: ChromaDB

### 주요 API 엔드포인트
```
POST /api/chat          # 통합 AI 채팅
GET  /api/location/nearby # 근처 커뮤니티 찾기
POST /api/share/group-purchase # 공동구매
POST /api/schedule/event # 일정 생성
```

---

## 🎯 핵심 기능

### 1. AI 육아상담 (최우선)
- OpenAI GPT-4o-mini 기반 24시간 챗봇
- HuggingFace 감정분석 (스트레스 레벨 측정)
- Vector DB (ChromaDB) 기반 RAG 검색
- 실시간 세션 관리

### 2. GPS 기반 위치 서비스
- 실시간 GPS 위치 추적
- 하버사인 공식으로 정확한 거리 계산
- 네이버 지도 API 연동
- 5가지 커뮤니티 유형 (아파트, 어린이집, 놀이터, 동네, 워킹맘)

### 3. 공동구매 및 나눔
- 12개 카테고리 (기저귀, 장난감, 도서 등)
- 4가지 공유 타입 (구매/공유/교환/대여)
- 위치 기반 매칭

---

## 🚫 금지 사항

### 크레딧 낭비 방지
1. **장시간 서버 실행 금지**
2. **중복 프로세스 실행 금지**
3. **불필요한 재시작 금지**
4. **테스트 완료 후 서버 종료 필수**

### 🔴 CRITICAL - 브랜치 관리 규칙
1. **메인 브랜치 절대 영향 주지 말 것 !!!**
2. **테스트 브랜치에서만 작업할 것**
3. **메인 브랜치 머지는 사용자와 상의 후에만**
4. **머지 완료 후 즉시 테스트 브랜치로 돌아갈 것**
5. **배포 서버 URL 절대 건드리지 말 것**

### 개발 규칙
1. **중복 질문하지 말 것** (이 문서 참조)
2. **인지 가이드라인 반복 설명 금지**
3. **효율적 소통을 위해 문서 기준 따를 것**

---

## ✅ 체크리스트

### 서버 실행 전
- [ ] 정말 테스트가 필요한가?
- [ ] 코드 수정으로 해결 가능한가?
- [ ] 기존 실행 중인 프로세스는 없는가?

### 서버 실행 후
- [ ] 테스트 완료했는가?
- [ ] KillBash로 프로세스 종료했는가?
- [ ] 더 이상 필요하지 않는가?

### 개발 완료 후
- [ ] 모든 코드 변경사항 커밋했는가?
- [ ] PR 생성/업데이트했는가?
- [ ] 실행 중인 프로세스 모두 종료했는가?

### 🔴 브랜치 관리 체크리스트
- [ ] 현재 테스트 브랜치에서 작업 중인가?
- [ ] 메인 브랜치를 건드리지 않았는가?
- [ ] 머지 전 사용자와 상의했는가?
- [ ] 머지 후 테스트 브랜치로 돌아갔는가?
- [ ] 배포 서버 설정을 변경하지 않았는가?

---

## 🔑 환경변수 & 설정

### 중요한 API 키들
- OpenAI API Key (GPT-4o-mini)
- 네이버 지도 API (클라이언트 ID/시크릿)
- Firebase 프로젝트 설정
- HuggingFace API 토큰

### 포트 설정
- 프론트엔드: 3000 (기본)
- 백엔드: 8000 (메인 API)
- LLM 서비스: 8002 (AI 채팅)

이 문서를 항상 참조하여 **크레딧을 절약하며 효율적으로 개발**하세요!